{"version":3,"sources":["pages/ChatPage/ChatPage.module.css","pages/ChatPage/ChatPage.tsx"],"names":["module","exports","Dialogs","className","s","dialogsBlock","dialogElement","src","dialogImage","dialogName","Chat","dispatch","useDispatch","status","useSelector","state","chat","useEffect","startMessagesListening","stopMessagesListening","Messages","AddMessageForm","messages","messagesAnchorRef","useRef","useState","isAutoScroll","setIsAutoScroll","current","scrollIntoView","behavior","style","height","width","overflowY","onScroll","e","element","currentTarget","Math","abs","scrollHeight","scrollTop","clientHeight","map","m","index","Message","key","message","ref","React","memo","padding","borderBottom","alt","photo","userPhoto","borderRadius","paddingLeft","userName","setMessage","autoSize","onChange","value","disabled","onClick","sendMessage","withAuthRedirect"],"mappings":"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","file":"static/js/5.d6e18a0f.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"dialogImage\":\"ChatPage_dialogImage__7QS8n\",\"dialogName\":\"ChatPage_dialogName__1ZEOz\",\"dialogElement\":\"ChatPage_dialogElement__1mPRZ\",\"dialogsBlock\":\"ChatPage_dialogsBlock__1f3Mj\"};","import {Button, Col, Row} from \"antd\"\r\nimport React, {FC, useEffect, useRef, useState} from \"react\"\r\nimport {ChatMessageAPIType} from \"../../api/chat-api\"\r\nimport {useDispatch, useSelector} from \"react-redux\";\r\nimport {sendMessage, startMessagesListening, stopMessagesListening} from \"../../redux/chat-reducer\";\r\nimport {AppStateType} from \"../../redux/store/redux-store\";\r\nimport TextArea from \"antd/lib/input/TextArea\";\r\nimport {Image} from 'antd';\r\nimport s from './ChatPage.module.css'\r\nimport userPhoto from \"../../assets/images/user.png\";\r\nimport {SendOutlined, MessageOutlined} from \"@ant-design/icons\";\r\nimport {withAuthRedirect} from \"../../hoc/withAuthRedirect\";\r\n\r\nconst ChatPage: FC = () => {\r\n    return (\r\n        <div>\r\n            <h2><MessageOutlined/> Мессенджер</h2>\r\n            <Row>\r\n                <Col>\r\n                    <Dialogs/>\r\n                </Col>\r\n                <Col>\r\n                    <Chat/>\r\n                </Col>\r\n            </Row>\r\n        </div>\r\n    )\r\n}\r\n\r\nconst Dialogs: FC = () => {\r\n    return (\r\n        <div className={s.dialogsBlock}>\r\n            <Row className={s.dialogElement}>\r\n                <Image src={\"https://picsum.photos/400/400\"} className={s.dialogImage}/>\r\n                <span className={s.dialogName}>Максим</span>\r\n            </Row>\r\n            <Row className={s.dialogElement}>\r\n                <Image src={\"https://picsum.photos/200/200\"} className={s.dialogImage}/>\r\n                <span className={s.dialogName}>Илья</span>\r\n            </Row>\r\n            <Row className={s.dialogElement}>\r\n                <Image src={\"https://picsum.photos/300/300\"} className={s.dialogImage}/>\r\n                <span className={s.dialogName}>Игорь</span>\r\n            </Row>\r\n            <Row className={s.dialogElement}>\r\n                <Image src={\"https://picsum.photos/100/100\"} className={s.dialogImage}/>\r\n                <span className={s.dialogName}>Александр</span>\r\n            </Row>\r\n        </div>\r\n    )\r\n}\r\n\r\nconst Chat: FC = () => {\r\n\r\n    const dispatch = useDispatch()\r\n\r\n    const status = useSelector((state: AppStateType) => state.chat.status)\r\n\r\n    useEffect(() => {\r\n        dispatch(startMessagesListening());\r\n        return () => {\r\n            dispatch(stopMessagesListening());\r\n        }\r\n    }, [])\r\n\r\n    return (\r\n        <div>\r\n            {status === 'error' && <div>Some error occurred. Please refresh the page</div>}\r\n            <>\r\n                <Messages/>\r\n                <AddMessageForm/>\r\n            </>\r\n        </div>\r\n    )\r\n}\r\n\r\nconst Messages: FC<{}> = ({}) => {\r\n    const messages = useSelector((state: AppStateType) => state.chat.messages)\r\n    const messagesAnchorRef = useRef<HTMLDivElement>(null)\r\n    const [isAutoScroll, setIsAutoScroll] = useState(false)\r\n\r\n    const scrollHandler = (e: React.UIEvent<HTMLDivElement, UIEvent>) => {\r\n        const element = e.currentTarget;\r\n        if (Math.abs((element.scrollHeight - element.scrollTop) - element.clientHeight) < 300) {\r\n            !isAutoScroll && setIsAutoScroll(true)\r\n        } else {\r\n            isAutoScroll && setIsAutoScroll(false)\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (isAutoScroll) {\r\n            messagesAnchorRef.current?.scrollIntoView({behavior: 'smooth'})\r\n        }\r\n    }, [messages])\r\n\r\n    return (\r\n        <div style={{height: '400px', width: '500px', overflowY: 'auto'}} onScroll={scrollHandler}>\r\n            {messages.map((m, index) => <Message key={index} message={m}/>)}\r\n            <div ref={messagesAnchorRef}>\r\n\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nconst Message: FC<{ message: ChatMessageAPIType }> = React.memo(({message}) => {\r\n    return (\r\n        <div>\r\n\r\n            <div style={{padding: '3px 0 0 10px', borderBottom: '1px #dadcdf solid'}}>\r\n                <img alt='User photo' src={message.photo !== null ? message.photo : userPhoto} style={{width: '30px', borderRadius: 15}}/>\r\n                <b style={{width: '30px', paddingLeft: 7}}>{message.userName}</b>\r\n                <br/>\r\n                {message.message}\r\n            </div>\r\n\r\n        </div>\r\n    )\r\n})\r\n\r\nconst AddMessageForm: FC<{}> = ({}) => {\r\n    const [message, setMessage] = useState('')\r\n    const dispatch = useDispatch()\r\n\r\n    const status = useSelector((state: AppStateType) => state.chat.status)\r\n\r\n    const sendMessageHandler = () => {\r\n        if (!message) {\r\n            return;\r\n        }\r\n        dispatch(sendMessage(message))\r\n        setMessage('')\r\n    }\r\n\r\n    return (\r\n        <Row>\r\n            <Col style={{padding: '20px 0 0 0'}}>\r\n                <TextArea autoSize={true} style={{width: 420, height: 30}} onChange={(e) => setMessage(e.currentTarget.value)}\r\n                          value={message}>\r\n\r\n                </TextArea>\r\n            </Col>\r\n            <Col style={{padding: '20px 0 0 0'}}>\r\n                <Button disabled={status !== 'ready'} onClick={sendMessageHandler}><SendOutlined /></Button>\r\n            </Col>\r\n        </Row>\r\n    )\r\n}\r\n\r\nexport default withAuthRedirect(ChatPage);"],"sourceRoot":""}